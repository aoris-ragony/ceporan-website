---
// src/components/NewsSlider.astro
const { images } = Astro.props;

// Validasi: Jika images null/undefined atau kosong, stop disini.
if (!images || !Array.isArray(images) || images.length === 0) {
  return null;
}
---

<div class="news-slider-wrapper">
  
  <div class="news-slider-container">
    <div class="news-slider-track" id="news-track">
      {images.map((imgUrl, index) => (
        <div class="news-slide">
          <img src={imgUrl} alt={`Foto dokumentasi ${index + 1}`} loading="lazy" />
        </div>
      ))}
    </div>

    <button class="nav-btn prev-btn" id="news-prev" aria-label="Foto Sebelumnya">&#10094;</button>
    <button class="nav-btn next-btn" id="news-next" aria-label="Foto Selanjutnya">&#10095;</button>
    
    <div class="slide-counter">
      <span id="current-slide">1</span> / {images.length}
    </div>
  </div>

</div>

<style>
  .news-slider-wrapper {
    width: 100%;
    margin: 2rem 0;
    /* Debugging: Jika background merah muncul tapi gambar tidak, berarti gambar gagal load */
    background-color: #f3f4f6; 
    border-radius: 12px;
  }

  .news-slider-container {
    position: relative;
    width: 100%;
    max-width: 800px;
    height: 400px; /* Tinggi Wajib ada */
    margin: 0 auto;
    overflow: hidden; /* Penting: Sembunyikan foto yang antre di samping */
    border-radius: 12px;
  }

  .news-slider-track {
    display: flex; /* Wajib Flex agar berjejer ke samping */
    height: 100%;
    transition: transform 0.5s ease-in-out;
    width: 100%;
  }

  .news-slide {
    min-width: 100%; /* Wajib 100% agar memenuhi container */
    height: 100%;
    flex-shrink: 0; /* Mencegah slide mengecil */
  }
  .news-slide img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    
    /* --- SETTING FOKUS --- */
    /* Karena slider berita ukurannya 2:1 (Landscape banget), */
    /* biasanya fokus tengah sudah paling aman */
    object-position: center center; 
  }
  .nav-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.5);
    color: white;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 1.2rem;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .nav-btn:hover { background: rgba(0, 0, 0, 0.8); }
  .prev-btn { left: 10px; }
  .next-btn { right: 10px; }

  .slide-counter {
    position: absolute;
    bottom: 15px;
    right: 15px;
    background: rgba(0,0,0,0.6);
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.9rem;
    z-index: 10;
  }

  @media (max-width: 768px) {
    .news-slider-container { height: 250px; }
  }
</style>

<script>
  // Script ini akan berjalan setiap kali komponen dimuat
  function initSlider() {
    const track = document.getElementById('news-track');
    const prevBtn = document.getElementById('news-prev');
    const nextBtn = document.getElementById('news-next');
    const counter = document.getElementById('current-slide');

    if (!track) {
      console.warn("Slider Track tidak ditemukan!");
      return;
    }

    // Ambil jumlah slide langsung dari elemen anak
    const slides = track.children;
    const totalSlides = slides.length;
    let currentIndex = 0;

    console.log(`Slider Berita Siap: Ditemukan ${totalSlides} foto.`);

    function updatePosition() {
      // Geser track berdasarkan persentase (lebih aman daripada pixel)
      track.style.transform = `translateX(-${currentIndex * 100}%)`;
      if(counter) counter.innerText = (currentIndex + 1).toString();
    }

    if (nextBtn) {
      nextBtn.addEventListener('click', () => {
        currentIndex = (currentIndex === totalSlides - 1) ? 0 : currentIndex + 1;
        updatePosition();
      });
    }

    if (prevBtn) {
      prevBtn.addEventListener('click', () => {
        currentIndex = (currentIndex === 0) ? totalSlides - 1 : currentIndex - 1;
        updatePosition();
      });
    }
  }

  // Jalankan fungsi
  initSlider();
  
  // Dukungan untuk Astro View Transitions (jika nanti Anda pakai)
  document.addEventListener('astro:page-load', initSlider);
</script>