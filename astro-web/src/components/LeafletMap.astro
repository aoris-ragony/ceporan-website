---
// src/components/LeafletMap.astro
// Tidak perlu import library di server side untuk menghindari error "window is not defined"
---

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>

<div id="map" class="map-container"></div>

<style>
  .map-container {
    height: 100%;
    width: 100%;
    min-height: 250px; /* Tinggi minimal agar peta tidak gepeng */
    z-index: 0; 
  }
</style>

<script is:inline src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

<script is:inline>
  // Fungsi inisialisasi peta
  function initMap() {
    // Koordinat Balai Desa Ceporan
    const lat = -7.7559673;
    const lng = 110.561622;

    // Cek apakah container peta ada
    const mapContainer = document.getElementById('map');
    
    // Cek apakah peta sudah pernah dibuat (untuk menghindari error "Map already initialized")
    if (mapContainer && !mapContainer._leaflet_id) {
      
      // 1. Buat Peta
      const map = L.map('map').setView([lat, lng], 15); // Angka 15 adalah level Zoom

      // 2. Tambahkan Tile Layer (Tampilan Peta)
      // Kita pakai OpenStreetMap (Gratis & Legal)
      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
          attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      }).addTo(map);

      // 3. Tambahkan Marker (Pin Merah/Biru)
      const marker = L.marker([lat, lng]).addTo(map);

      // 4. Tambahkan Popup (Tulisan saat diklik)
      marker.bindPopup("<b>Kantor Desa Ceporan</b><br>Kec. Gantiwarno, Klaten.").openPopup();
    }
  }

  // Jalankan saat halaman selesai dimuat
  document.addEventListener('DOMContentLoaded', initMap);

  // Jalankan ulang jika menggunakan View Transitions (Opsional, jaga-jaga)
  document.addEventListener('astro:page-load', initMap);
</script>