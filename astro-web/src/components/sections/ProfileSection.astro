---
// src/components/sections/ProfileSection.astro
import { client } from '../../lib/sanity';
import { PortableText } from "astro-portabletext";

// Ambil data profil desa
const rawProfile = await client.fetch(`*[_type == "profilDesa"][0]`);
const profile = rawProfile || {};

// Fallback data jika kosong
const visi = profile.visi || "Visi belum diisi di Sanity.";
const misi = profile.misi || []; // Misi biasanya array di Sanity
const tentang = profile.tentangDesa || "Deskripsi desa belum diisi.";
---

<section id="profil" class="profile-section">
  
  <div class="top-content">
    <div class="container">
      <div class="section-header">
        <h2>Profil Desa</h2>
        <div class="underline"></div>
      </div>

      <div class="about-wrapper">
        <h3>Tentang Desa</h3>
        <div class="about-text">
          {typeof tentang === 'string' ? <p>{tentang}</p> : <PortableText value={tentang} />}
        </div>
      </div>
    </div>
  </div>

  <div class="wave-separator">
    <svg viewBox="0 0 1440 120" fill="none" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
        <path d="M0 60L48 65C96 70 192 80 288 83.3C384 86.7 480 83.3 576 73.3C672 63.3 768 46.7 864 41.7C960 36.7 1056 43.3 1152 53.3C1248 63.3 1344 76.7 1392 83.3L1440 90V120H1392C1344 120 1248 120 1152 120C1056 120 960 120 864 120C768 120 672 120 576 120C480 120 384 120 288 120C192 120 96 120 48 120H0V60Z" fill="#eff6ff"></path>
    </svg>
  </div>

  <div class="bottom-content">
    <div class="container">
      
      <div class="vm-grid">
        <div class="vm-card visi-card">
          <div class="icon-box"></div>
          <h3>Visi</h3>
          <p class="visi-text">"{visi}"</p>
        </div>

        <div class="vm-card misi-card">
          <div class="icon-box"></div>
          <h3>Misi</h3>
          <div class="misi-list">
             {Array.isArray(misi) ? (
                <ul>
                  {misi.map((item: any) => (
                    <li>{item.children ? item.children[0].text : item}</li>
                  ))}
                </ul>
             ) : (
                <PortableText value={misi} />
             )}
          </div>
        </div>
      </div>

    </div>
  </div>

</section>

<style>
  /* --- LAYOUT UMUM --- */
  .profile-section {
    position: relative;
    /* Tidak ada padding global, kita atur per bagian */
  }

  .container {
    max-width: 1000px; /* Lebar konten agar enak dibaca */
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  .section-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .section-header h2 {
    font-size: 2.5rem;
    color: #111827;
    margin-bottom: 0.5rem;
    font-weight: 800;
  }

  .underline {
    width: 60px;
    height: 4px;
    background-color: #1a56db; /* Biru utama */
    margin: 0 auto;
    border-radius: 2px;
  }

  /* --- BAGIAN ATAS (TENTANG) --- */
  .top-content {
    background-color: #ffffff;
    padding: 6rem 0 2rem 0; /* Padding atas besar */
    text-align: center;
  }

  .about-wrapper h3 {
    font-size: 1.8rem;
    color: #1a56db;
    margin-bottom: 1.5rem;
  }

  .about-text {
    font-size: 1.1rem;
    line-height: 1.8;
    color: #4b5563;
    max-width: 800px;
    margin: 0 auto; /* Tengah horizontal */
  }

  /* --- SEPARATOR WAVE (LENGKUNGAN) --- */
  .wave-separator {
    line-height: 0; /* Menghilangkan gap misterius */
    width: 100%;
    overflow: hidden;
  }
  
  .wave-separator svg {
    display: block;
    width: 100%;
    height: 60px; /* Tinggi lengkungan */
    fill: #eff6ff; /* Warna ini HARUS SAMA dengan background bottom-content */
  }

  /* --- BAGIAN BAWAH (VISI MISI) --- */
  .bottom-content {
    background-color: #eff6ff; /* Biru sangat muda (senada dengan tema) */
    padding: 2rem 0 6rem 0;
  }

  .vm-grid {
    display: grid;
    grid-template-columns: 1fr 1fr; /* Kiri Visi, Kanan Misi */
    gap: 3rem;
    margin-top: 1rem;
  }

  .vm-card {
    background: white;
    padding: 2.5rem;
    border-radius: 16px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05); /* Shadow halus */
    transition: transform 0.3s ease;
    text-align: center; /* Default tengah */
  }

  .vm-card:hover {
    transform: translateY(-5px); /* Efek naik saat hover */
    box-shadow: 0 10px 15px rgba(0,0,0,0.1);
  }

  .misi-card {
    /* Misi rata kiri agar list rapi */
  }
  .misi-list {
    text-align: left; /* HANYA daftar isinya yang rata kiri */
    margin-top: 1rem;
    display: inline-block; /* Agar blok list tetap rapi di tengah container */
    width: 100%;
  }

  .icon-box {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    display: inline-block;
  }

  .vm-card h3 {
    color: #111827;
    font-size: 1.5rem;
    margin-bottom: 1.5rem;
    font-weight: 700;
  }

  .visi-text {
    font-style: italic;
    font-size: 1.2rem;
    color: #374151;
    font-weight: 500;
  }

  .misi-list ul {
    padding-left: 1.2rem;
    margin: 0;
  }

  .misi-list li {
    margin-bottom: 0.8rem;
    color: #4b5563;
    line-height: 1.6;
  }

  /* --- RESPONSIF HP --- */
  @media (max-width: 768px) {
    .vm-grid {
      grid-template-columns: 1fr; /* Tumpuk visi misi di HP */
      gap: 2rem;
    }
    
    .wave-separator svg {
      height: 30px; /* Lengkungan lebih kecil di HP */
    }
  }
</style>